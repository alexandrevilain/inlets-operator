# inlets-operator chart

## Pre-reqs

- Configure [helm and tiller](https://github.com/openfaas/faas-netes/blob/master/HELM.md)

- Add the chart repo

  ```sh
  helm repo add inlets https://inlets.github.io/inlets-operator/
  helm repo update
  ```

- Create your access key secret, then apply one of the following configurations.

- Install the CRD:

  ```sh
  kubectl apply -f ./artifacts/crd.yaml
  ```

## Configuration

The following table lists the configurable parameters of the `inlets-operator` chart and their default values,
and can be overwritten via the helm `--set` flag.

Parameter | Description | Default
---                             | ---                                                                     | ---
`image`                 | Docker image for the Inlets Operator                                            | `inlets/inlets-operator:0.4.2`
`clientImage`           | Docker image for the inlets client                                              | `inlets/inlets:2.6.1`
`provider`              | Your infrastructure provider - 'packet' or 'digitalocean'                       | `""`
`region`                | The region to provision hosts into                                              | `""`
`accessKeyFile`         | Read the access key for your infrastructure provider from a file (recommended)  | `/var/secrets/inlets/inlets-access-key`
`packetProjectId`       | The project ID if using Packet.com as the provider                              | `""`
`annotatedOnly`         | Only create a tunnel for annotated services.                                    | `false`
`inletsProLicense`      | License for use with inlets-pro                                                 | `""`
`resources`             | Operator resources requests & limits                                            | `{"requests":{"cpu": "100m", "memory": "128Mi"}}`
`nodeSelector`          | Node labels for data pod assignment                                             | `{}`
`tolerations`           | Node tolerations                                                                | `[]`
`affinity`              | Node affinity policy                                                            | `{}`

## Deploy an example configuration

### DigitalOcean with inlets OSS (recommended)

Create a secret with an API key generated by DigitalOcean

```sh
kubectl create secret generic inlets-access-key \
--from-literal inlets-access-key="$(cat ~/Downloads/do-access-token)"
```

Then:

```sh
helm upgrade inlets-operator --install inlets/inlets-operator
```

### DigitalOcean with inlets-pro

```sh
helm upgrade inlets-operator --install inlets/inlets-operator \
  --set license=JWT_GOES_HERE
```

### Packet.com with inlets OSS

```sh
helm upgrade inlets-operator --install inlets/inlets-operator \
  --set provider=packet,region=ams1,packetProjectId=PACKETID
```

### Scaleway.com with inlets OSS

kubectl create secret generic inlets-access-key \
 --from-literal inlets-access-key="SCALEWAY_ACCESS_KEY" \
 --from-literal inlets-secret-key="SCALEWAY_ACCESS_KEY"

```sh
helm upgrade inlets-operator --install inlets/inlets-operator \
  --set provider=scaleway,region=fr-par-1,scalewayOrganizationId=ORG,secretKeyFile=/var/secrets/inlets/inlets-secret-key
```
